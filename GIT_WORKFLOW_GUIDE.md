# Spring Migration Git Workflow Guide

## üéØ Problem Solved

**Before**: Migration tool created files with flattened names like `src_main_java_User.java` which made git tracking impossible.

**Now**: Migration tool creates a proper workspace with preserved directory structure + comprehensive git workflow.

## üèóÔ∏è New Migration Workspace Structure

When you run the migration tool, it now creates:

```
./migration_analysis/
‚îú‚îÄ‚îÄ MyProject_backup_20241215_143022/           # Safety backup (flattened files)
‚îÇ   ‚îú‚îÄ‚îÄ backup_manifest.json
‚îÇ   ‚îú‚îÄ‚îÄ src_main_java_User.java                # Flattened for safety
‚îÇ   ‚îî‚îÄ‚îÄ pom.xml
‚îÇ
‚îî‚îÄ‚îÄ MyProject_migration_20241215_143022/        # Git-ready workspace
    ‚îú‚îÄ‚îÄ MIGRATION_README.md                     # Instructions
    ‚îú‚îÄ‚îÄ git-migration-workflow.sh               # Helper script
    ‚îú‚îÄ‚îÄ src/                                    # PROPER directory structure
    ‚îÇ   ‚îî‚îÄ‚îÄ main/
    ‚îÇ       ‚îî‚îÄ‚îÄ java/
    ‚îÇ           ‚îî‚îÄ‚îÄ com/
    ‚îÇ               ‚îî‚îÄ‚îÄ example/
    ‚îÇ                   ‚îî‚îÄ‚îÄ User.java           # Ready for git!
    ‚îú‚îÄ‚îÄ pom.xml
    ‚îî‚îÄ‚îÄ .git/                                   # Git repository initialized
```

## üîÑ Complete Workflow

### 1. **Run Migration Analysis**
```bash
python3 main.py --local-dir /path/to/your/spring/project
```

**What happens:**
- ‚úÖ Analyzes your Spring project
- ‚úÖ Creates safety backup with flattened names
- ‚úÖ Creates migration workspace with proper directory structure
- ‚úÖ Initializes git repository in workspace
- ‚úÖ Creates initial commit with your source code
- ‚úÖ Creates helper scripts

### 2. **Navigate to Migration Workspace**
```bash
cd ./migration_analysis/MyProject_migration_20241215_143022/
```

### 3. **Use the Interactive Git Helper**
```bash
# Option 1: Use the interactive Python helper
python3 ../../migration_git_helper.py

# Option 2: Use the generated bash script
./git-migration-workflow.sh

# Option 3: Use git commands directly
git status
git diff
```

### 4. **Review Your Changes**

#### Quick Overview:
```bash
git status              # See what files changed
git diff --stat         # See change statistics
```

#### Detailed Review:
```bash
git diff                                    # All changes
git diff src/main/java/com/example/        # Specific directory
git diff src/main/java/User.java           # Specific file
```

#### Using the Interactive Helper:
```bash
python3 ../../migration_git_helper.py
# Then choose "1" for review changes
```

### 5. **Stage and Commit Changes**

#### Stage All Changes:
```bash
git add .
```

#### Stage Specific Files:
```bash
git add src/main/java/User.java
git add pom.xml
```

#### Commit with Auto-Generated Message:
```bash
git commit -m "Spring 5 to 6 migration - Automated changes

- Updated javax.* to jakarta.* imports
- Migrated Spring Security configuration  
- Updated dependency versions
- Fixed deprecated API usage

Generated by Spring Migration Tool"
```

### 6. **Create Migration Branch (Recommended)**
```bash
git checkout -b spring-6-migration
git commit -m "Spring 6 migration changes"
```

### 7. **Export Changes**

#### Option A: Create Patch File
```bash
git diff HEAD~1 > ../spring-migration.patch
# Apply later with: git apply spring-migration.patch
```

#### Option B: Copy Files Back to Original Project
```bash
python3 ../../migration_git_helper.py
# Choose "copy" option and specify your original project path
```

#### Option C: Manual Copy
```bash
# Copy modified files back to your original project
cp -r src/ /path/to/your/original/project/
cp pom.xml /path/to/your/original/project/
```

## üõ†Ô∏è Interactive Git Helper Features

The `migration_git_helper.py` script provides:

### **Auto-Detection**
- Automatically finds the most recent migration workspace
- No need to specify paths manually

### **Interactive Operations**
1. **Review changes** - See exactly what was modified
2. **Stage changes** - Selectively add files for commit
3. **Smart commits** - Auto-generated commit messages
4. **Patch creation** - Export changes as patch files
5. **Copy to original** - Safely copy changes back with dry-run option

### **Usage Examples**

#### Quick Status Check:
```bash
python3 migration_git_helper.py --status
```

#### Interactive Mode:
```bash
python3 migration_git_helper.py --interactive
```

#### Auto Stage and Commit:
```bash
python3 migration_git_helper.py --commit
```

#### Create Patch File:
```bash
python3 migration_git_helper.py --patch spring-migration.patch
```

## üìã Common Git Operations

### **See What Changed**
```bash
# File list with change types
git diff --name-status

# Statistics
git diff --stat

# Full diff
git diff
```

### **Selective Staging**
```bash
# Stage all Java files
git add "*.java"

# Stage specific directories
git add src/main/java/

# Interactive staging
git add -p
```

### **Branch Management**
```bash
# Create feature branch
git checkout -b feature/spring-6-migration

# Switch between branches  
git checkout main
git checkout feature/spring-6-migration

# Merge changes
git checkout main
git merge feature/spring-6-migration
```

### **Undo Operations**
```bash
# Unstage files
git reset HEAD <file>

# Discard changes
git checkout -- <file>

# Reset to previous commit
git reset --hard HEAD~1
```

## üîí Safety Features

### **Multiple Backups**
1. **Flattened backup** - Safe copy with original content
2. **Git history** - Full version control in workspace
3. **Manifest files** - Complete record of all operations

### **Non-Destructive**
- Original project is never modified
- All changes happen in isolated workspace
- Easy rollback with git reset

### **Validation Steps**
- Dry-run option for copying files back
- Interactive review before applying changes
- Git diff validation before commits

## üö® Troubleshooting

### **"Migration workspace not found"**
```bash
# Specify workspace manually
python3 migration_git_helper.py --workspace ./MyProject_migration_20241215_143022/
```

### **"No git repository"**
```bash
cd migration_workspace
git init
git add .
git commit -m "Initial commit"
```

### **"Files have wrong structure"**
Check that you're in the migration workspace (not backup directory):
```bash
ls -la  # Should show src/, pom.xml, etc. (not flattened names)
```

### **"Changes not showing"**
Make sure migration changes were actually applied:
```bash
git status
git log --oneline
```

## üìñ Example Complete Workflow

```bash
# 1. Run migration
python3 main.py --local-dir ~/my-spring-project

# 2. Navigate to workspace  
cd ./migration_analysis/my-spring-project_migration_20241215_143022/

# 3. Review changes
git status
git diff --stat

# 4. Review specific changes
git diff src/main/java/com/example/UserService.java

# 5. Stage and commit
git add .
git commit -m "Spring 5 to 6 migration

- Updated 15 Java files with javax ‚Üí jakarta imports
- Migrated Spring Security configuration
- Updated pom.xml dependencies
- Fixed deprecated API usage

ü§ñ Generated by Spring Migration Tool"

# 6. Create patch for original project
git diff HEAD~1 > ../spring-6-migration.patch

# 7. Copy back to original (with dry run first)
python3 ../../migration_git_helper.py
# Choose 'copy' option, then your original project path
```

## üéâ Benefits

‚úÖ **Proper Git History** - Track every change with standard git tools  
‚úÖ **Directory Structure Preserved** - No more flattened file names  
‚úÖ **Safe Migration** - Multiple backup levels and rollback options  
‚úÖ **Easy Review** - Standard git diff tools work perfectly  
‚úÖ **Selective Application** - Choose which changes to apply  
‚úÖ **Professional Workflow** - Industry-standard git practices  
‚úÖ **Automation Ready** - Scripts for CI/CD integration  

The new workflow solves your original question: **"how can I check in the migrated changes into git as the file name contains the folder path as well"** by creating a proper git workspace with preserved directory structure, making it easy to track, review, and apply migration changes! üöÄ